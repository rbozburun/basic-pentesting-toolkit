#!/usr/bin/python3

import argparse
import requests
import urllib
from termcolor import colored

def main():
    parser = argparse.ArgumentParser(description="Directory listing vulnerability controller.")
    parser.add_argument('-f','--url_file', help="URL list file.")
    args = parser.parse_args()
    url_file = args.url_file

    f = open(url_file,'r')
    urls = f.readlines()
    f.close()
    
    trace_allows_list = []
    for url in urls:
        url = url[:-1]
        print("TRACE method testing for: {0}".format(url))
        try:
            req = requests.options(url)
            if req.status_code == requests.codes.ok:
                if "TRACE" in req.headers['Allow']:
                    if url not in trace_allows_list:
                        hostname = urllib.parse.urlparse(url).hostname
                        port = urllib.parse.urlparse(url).port
                        text = "[+] {0} - {1}/TCP -> {2}\n".format(hostname,port,url)
                        trace_allows_list.append(text)
                        print(colored(text,'green'))

        except Exception as e:
            print("|> URL request error, passing the next one...\n")

    if len(trace_allows_list) > 0:
        fout = open("trace_supported_urls.txt","w")
        fout.writelines(trace_allows_list)
        fout.close()
        

if __name__ == "__main__":
    main()