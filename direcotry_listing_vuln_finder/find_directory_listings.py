#!/usr/bin/python3

import re
import argparse
import requests
from time import sleep




def main():
    parser = argparse.ArgumentParser(description="Directory listing vulnerability controller.")
    parser.add_argument('-f','--url_file', help="URL list file.")
    args = parser.parse_args()
    url_file = args.url_file

    f = open(url_file,'r')
    urls = f.readlines()
    f.close()

    for url in urls:
        url = str(url[:-1]) 
        print("[!] Checking Directory Listing for: {0}".format(url))
        try:
            resp = requests.get(url, timeout=7, allow_redirects=False)
            page_content = resp.content.decode('utf-8', errors="replace")
        except Exception as e:
            print("|_> URL request error, passing the next one...")
        else:
            if resp.status_code == requests.codes.ok:
                try:
                    if "Index of" in page_content:
                        print("[+] possible directory listing found: {0}".format(url))
                        with open("directory_listing_urls.txt","a") as outF:
                            outF.write(url + "\n")
                except Exception as e:
                    print(e)
                    print(url)
                    print(page_content)

if __name__ == "__main__":
    main()